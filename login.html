<script>
    async function login() {
        const usuario = document.getElementById("usuario").value.trim();
        const senha   = document.getElementById("senha").value.trim();
        const loja    = document.getElementById("loja").value;

        const msg = document.getElementById("msg");
        msg.textContent = "";
        msg.style.color = "#b30000";

        if (!usuario || !senha || !loja) {
            msg.textContent = "Preencha todos os campos.";
            return;
        }

        try {
            const resposta = await fetch("/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usuario, senha, loja })
            });

            const dados = await resposta.json();

            if (!resposta.ok || !dados.sucesso) {
                msg.textContent = dados.message || "Usuário, senha ou loja inválidos.";
                return;
            }

            // SUCESSO: mostra mensagem rápida…
            msg.style.color = "green";
            msg.textContent = "Login autorizado.";

            // …e redireciona para o painel COM os parâmetros
            window.location.href =
                `/painel.html?usuario=${encodeURIComponent(usuario)}&` +
                `loja=${encodeURIComponent(loja)}`;

        } catch (erro) {
            console.error(erro);
            msg.textContent = "Erro de conexão com o servidor.";
        }
    }
</script>
