<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel PPP</title>

  <style>
    /* ======== ESTILO GERAL DA PÁGINA ======== */
    body {
      background: #f3f3f3;
      font-family: Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Card do painel */
    .container {
      width: 95%;
      max-width: 900px;
      background: #ffffff;
      padding: 24px 28px 30px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }

    .cabecalho {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      border-bottom: 1px solid #e1e1e1;
      padding-bottom: 14px;
      margin-bottom: 16px;
    }

    .titulo {
      margin: 0;
      font-size: 22px;
    }

    .subtitulo {
      margin: 4px 0 0;
      font-size: 14px;
      color: #555;
    }

    .info-usuario {
      text-align: right;
      font-size: 14px;
    }

    .info-usuario strong {
      display: block;
    }

    .conteudo {
      margin-top: 12px;
      font-size: 14px;
    }

    /* TOPO – busca + campos extras */

    .topo {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* CAIXA DE BUSCA */
    .search-container {
      width: 100%;
      position: relative;
      margin-bottom: 16px;
    }

    #campoBusca {
      width: 100%;
      padding: 16px 60px 16px 60px;
      font-size: 16px;
      border: 2px solid #bbb;
      border-radius: 12px;
      outline: none;
      background: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.10);
      box-sizing: border-box;
    }

    .btnBarcodeLeft {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      padding: 0;
      margin: 0;
      cursor: pointer;
      width: 32px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-barcode-small {
      width: 100%;
      height: 100%;
      border-radius: 4px;
      background:
        repeating-linear-gradient(
          90deg,
          #333 0px,
          #333 3px,
          #fff 3px,
          #fff 5px
        );
    }

    .btnBuscarIcone {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* TEXTAREA DE OBSERVAÇÃO */
    .obs-container {
      width: 100%;
      margin-top: 8px;
      margin-bottom: 12px;
    }

    .obs-label {
      font-size: 14px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .obs-textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: 10px;
      border: 1.5px solid #bbb;
      padding: 10px 12px;
      font-size: 14px;
      resize: vertical;
      min-height: 100px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    /* LINHA: QTD / VALOR / Nº DOC */

    .linha-infos {
      width: 100%;
      display: flex;
      gap: 10px;
      margin-top: 4px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .campo-inline {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .qtd-label {
      font-size: 14px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .input-inline {
      width: 100%;
      box-sizing: border-box;
      border-radius: 10px;
      border: 1.5px solid #bbb;
      padding: 10px 12px;
      font-size: 14px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    .status-msg {
      font-size: 13px;
      margin-top: 8px;
      text-align: center;
      min-height: 20px;
    }

    /* CARTÕES DE RESULTADO */

    .cartao {
      width: 100%;
      background: white;
      padding: 16px 16px;
      margin: 14px auto;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: translateY(6px);
      animation: entrarCartao 0.20s ease-out forwards;
      cursor: pointer;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
    }

    .cartao:hover {
      transform: translateY(2px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.16);
    }

    .cartao p {
      margin: 6px 0;
      font-size: 14px;
      line-height: 18px;
    }

    .cartao strong {
      font-size: 14px;
      color: #111;
    }

    @keyframes entrarCartao {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* CÂMERA (mantida para futuro uso) */

    #cameraArea {
      margin-top: 18px;
      display: none;
      width: 100%;
    }

    #cameraArea video {
      width: 100%;
      border-radius: 10px;
      border: 2px solid #ddd;
      margin-top: 10px;
      background: white;
    }

    .btnFechar {
      width: 100%;
      padding: 10px 14px;
      font-size: 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
      max-width: 260px;
      background: #777;
      color: white;
    }

    /* OVERLAY DE CARREGAMENTO */

    #overlayCarregando {
      position: fixed;
      inset: 0;
      background: rgba(243,243,243,0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loader {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 6px solid #ddd;
      border-top-color: #0066ff;
      animation: girar 0.9s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes girar {
      to { transform: rotate(360deg); }
    }

    .texto-carregando {
      font-size: 15px;
      text-align: center;
      color: #333;
    }

    #percentualCarregando {
      font-size: 16px;
      font-weight: bold;
      margin-top: 6px;
      color: #0066ff;
    }

    /* POPUP DE CONFIRMAÇÃO DE ENVIO */

    #confirmOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .confirm-box {
      background: #fff;
      padding: 20px 18px;
      border-radius: 12px;
      max-width: 380px;
      width: 90%;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      text-align: center;
    }

    .confirm-box p {
      font-size: 15px;
      margin-bottom: 16px;
    }

    .confirm-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .btnConfirmar,
    .btnCancelar {
      flex: 1;
      padding: 10px 8px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      cursor: pointer;
    }

    .btnConfirmar {
      background: #0066ff;
      color: #fff;
      font-weight: 600;
    }

    .btnCancelar {
      background: #e0e0e0;
      color: #333;
    }

    .btn-voltar {
      margin-top: 16px;
      display: inline-block;
      padding: 8px 14px;
      background: #0066ff;
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
    }

    /* Tela de acesso inválido */

    .tela-erro {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: #f3f3f3;
      font-family: Arial, sans-serif;
    }

    .card-erro {
      background: #fff;
      padding: 26px 30px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      max-width: 420px;
      text-align: center;
    }

    .card-erro h1 {
      color: #c00000;
      margin-top: 0;
    }

  </style>
</head>

<body>
  <!-- POPUP DE CONFIRMAÇÃO -->
  <div id="confirmOverlay">
    <div class="confirm-box">
      <p>Você deseja mesmo enviar o Relatório?</p>
      <div class="confirm-buttons">
        <button class="btnConfirmar" onclick="confirmarEnvio(true)">
          Sim
        </button>
        <button class="btnCancelar" onclick="confirmarEnvio(false)">
          Cancelar envio
        </button>
      </div>
    </div>
  </div>

  <!-- OVERLAY DE CARREGAMENTO DA BASE -->
  <div id="overlayCarregando">
    <div class="loader"></div>
    <div class="texto-carregando">Carregando base de produtos...</div>
    <div id="percentualCarregando">0%</div>
  </div>

  <!-- O conteúdo principal do painel será montado via JS,
       depois que validarmos usuario/loja na URL -->
  <script>
    // ========== VARIÁVEIS GLOBAIS ==========
    let dbProdutos = [];         // base completa A:H vinda da API
    let baseCarregada = false;   // indica se /api/produtos já foi carregada
    let lojaLogada = null;       // loja vinda da URL
    let usuarioLogado = null;    // usuário vindo da URL
    let ultimosResultados = [];  // última busca exibida

    // Dados aguardando confirmação no popup
    let envioPendente = null;

    let percentual = 0;
    let timerPercent = null;

    // ========== FUNÇÕES DE LOADING (PERCENTUAL) ==========
    function iniciarLoadingPercentual() {
      const overlay = document.getElementById("overlayCarregando");
      const txt = document.getElementById("percentualCarregando");

      overlay.style.display = "flex";
      percentual = 0;
      txt.textContent = "0%";

      if (timerPercent) clearInterval(timerPercent);

      timerPercent = setInterval(() => {
        if (percentual < 95) {
          percentual += 5;
          txt.textContent = percentual + "%";
        }
      }, 120);
    }

    function finalizarLoadingPercentual() {
      const txt = document.getElementById("percentualCarregando");
      const overlay = document.getElementById("overlayCarregando");

      if (timerPercent) clearInterval(timerPercent);

      percentual = 100;
      txt.textContent = "100%";

      setTimeout(() => {
        overlay.style.display = "none";
      }, 250);
    }

    // Beep simples (usado ao clicar em cartão ou leitura futura)
    function playBeep() {
      try {
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.type = "sine";
        osc.frequency.value = 880;

        osc.connect(gain);
        gain.connect(ctx.destination);

        gain.gain.setValueAtTime(0.001, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);

        osc.start();
        osc.stop(ctx.currentTime + 0.15);
      } catch (e) {}
    }

    // Máscara de valor unitário estilo R$
    function mascaraValorUnitario(campo) {
      let v = campo.value.replace(/\D/g, "");

      if (!v) {
        campo.value = "";
        return;
      }

      v = v.replace(/^0+/, "");
      if (!v) {
        v = "0";
      }

      while (v.length < 3) {
        v = "0" + v;
      }

      const inteiro = v.slice(0, -2);
      const centavos = v.slice(-2);
      const inteiroFormatado = inteiro.replace(/\B(?=(\d{3})+(?!\d))/g, ".");

      campo.value = inteiroFormatado + "," + centavos;
    }

    // ========== LOGIN VIA PARÂMETROS DA URL ==========
    document.addEventListener("DOMContentLoaded", () => {
      const params  = new URLSearchParams(window.location.search);
      const usuario = params.get("usuario");
      const loja    = params.get("loja");

      // Se não vier usuário ou loja na URL, bloqueia acesso ao painel
      if (!usuario || !loja) {
        document.body.innerHTML = `
          <div class="tela-erro">
            <div class="card-erro">
              <h1>Acesso inválido</h1>
              <p>Parâmetros do login não encontrados.</p>
              <p>Volte para a tela de acesso e realize o login novamente.</p>
              <a href="/login.html" class="btn-voltar">Voltar para o Login</a>
            </div>
          </div>
        `;
        return;
      }

      usuarioLogado = usuario;
      lojaLogada    = loja;

      // Monta o layout do painel
      montarPainel(usuario, loja);

      // Depois que o painel existe no DOM, carrega a base da API
      carregarBase();
    });

    // Monta o HTML principal do painel
    function montarPainel(usuario, loja) {
      document.body.innerHTML = `
        <div class="container">
          <div class="cabecalho">
            <div>
              <h1 class="titulo">Painel PPP</h1>
              <p class="subtitulo">
                Relatório de Prevenção de Perdas – base única de produtos.
              </p>
            </div>
            <div class="info-usuario">
              <strong>Usuário: ${sanitize(usuario)}</strong>
              <span>Loja: ${sanitize(loja)}</span>
            </div>
          </div>

          <div class="conteudo">
            <div class="topo">

              <div class="search-container">
                <button
                  type="button"
                  class="btnBarcodeLeft"
                  onclick="abrirCamera()"
                  aria-label="Ler código de barras com a câmera"
                >
                  <span class="icon-barcode-small"></span>
                </button>

                <input
                  id="campoBusca"
                  type="text"
                  placeholder="Pesquisar produto por EAN, código ou descrição"
                  onkeydown="if(event.key === 'Enter'){buscar();}"
                />

                <button
                  type="button"
                  class="btnBuscarIcone"
                  onclick="buscar()"
                  aria-label="Buscar produto"
                >
                  <svg width="26" height="26" viewBox="0 0 24 24"
                    fill="none" stroke="#444" stroke-width="2.2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="7"></circle>
                    <line x1="16.65" y1="16.65" x2="21" y2="21"></line>
                  </svg>
                </button>
              </div>

              <!-- RELATÓRIO -->
              <div class="obs-container">
                <div class="obs-label">Relatório / Observação:</div>
                <textarea
                  id="observacao"
                  class="obs-textarea"
                  placeholder="Digite aqui a observação que será enviada junto com o produto clicado..."
                ></textarea>
              </div>

              <!-- QUANTIDADE | VALOR UNITÁRIO | Nº DOCUMENTO -->
              <div class="linha-infos">
                <div class="campo-inline">
                  <div class="qtd-label">Quantidade:</div>
                  <input
                    id="quantidade"
                    class="input-inline"
                    type="text"
                    inputmode="decimal"
                    placeholder="Qtd"
                    oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"
                  />
                </div>

                <div class="campo-inline">
                  <div class="qtd-label">Valor unitário (R$):</div>
                  <input
                    id="valorUnitario"
                    class="input-inline"
                    type="text"
                    inputmode="decimal"
                    placeholder="0,00"
                    oninput="mascaraValorUnitario(this)"
                  />
                </div>

                <div class="campo-inline">
                  <div class="qtd-label">Nº de Documento:</div>
                  <input
                    id="numeroDocumento"
                    class="input-inline"
                    type="text"
                    inputmode="numeric"
                    placeholder="Número"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                  />
                </div>
              </div>

              <div id="status" class="status-msg"></div>
            </div>

            <div id="cameraArea">
              <p style="font-size: 13px;">Aponte para o código de barras:</p>
              <video id="video" autoplay playsinline></video>
              <p id="msgCamera" style="font-size: 12px;"></p>
              <button class="btnFechar" onclick="fecharCamera()">Fechar câmera</button>
            </div>

            <div id="resultado" style="width:100%; margin-top:14px;"></div>

            <a href="/login.html" class="btn-voltar">Sair / Trocar de Loja</a>
          </div>
        </div>
      `;
    }

    // Sanitiza texto para evitar problemas ao injetar no HTML
    function sanitize(texto) {
      return String(texto)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ========== CARREGAR BASE A PARTIR DA API /api/produtos ==========

    async function carregarBase() {
      const status = document.getElementById("status");
      status.textContent = "Carregando base de produtos...";
      iniciarLoadingPercentual();

      try {
        const resposta = await fetch("/api/produtos");
        const dados = await resposta.json().catch(() => ({}));

        if (!resposta.ok || !dados.sucesso || !Array.isArray(dados.produtos)) {
          baseCarregada = false;
          status.textContent =
            dados.message || "Erro ao carregar base de produtos.";
          finalizarLoadingPercentual();
          return;
        }

        dbProdutos = dados.produtos || [];
        baseCarregada = true;
        status.textContent =
          `Base carregada com ${dbProdutos.length} produto(s).`;
        finalizarLoadingPercentual();
      } catch (erro) {
        console.error("Erro ao carregar base da API:", erro);
        baseCarregada = false;
        status.textContent =
          "Erro de conexão ao carregar base de produtos.";
        finalizarLoadingPercentual();
      }
    }

    // ========== BUSCA LOCAL NA BASE ==========

    function buscar() {
      const campo = document.getElementById("campoBusca");
      const termoBruto = campo.value.trim();
      const status = document.getElementById("status");

      if (!termoBruto) {
        status.textContent = "Digite ou leia um código / descrição para buscar.";
        return;
      }

      if (!baseCarregada) {
        status.textContent = "Aguarde o carregamento da base (100%).";
        return;
      }

      const termo = termoBruto.toLowerCase();

      const resultados = dbProdutos.filter(linha => {
        const ean      = String(linha[0] ?? "").toLowerCase();
        const consinco = String(linha[1] ?? "").toLowerCase();
        const produto  = String(linha[2] ?? "").toLowerCase();

        return (
          ean === termo ||
          consinco === termo ||
          produto.includes(termo)
        );
      });

      mostrarResultados(resultados);
    }

    // Mostra resultados em cartões clicáveis
    function mostrarResultados(dados) {
      const container = document.getElementById("resultado");
      const status = document.getElementById("status");

      if (!dados || dados.length === 0) {
        container.innerHTML =
          '<p style="font-size: 13px; text-align:center;">Nenhum resultado encontrado.</p>';
        ultimosResultados = [];
        status.textContent = "Nenhum produto encontrado para o termo informado.";
        return;
      }

      ultimosResultados = dados;

      let html = "";
      dados.forEach((linha, idx) => {
        html += `
          <div class="cartao" onclick="enviarRelatorio(${idx})">
            <p><strong>EAN:</strong> ${linha[0] ?? ""}</p>
            <p><strong>Cód Consinco:</strong> ${linha[1] ?? ""}</p>
            <p><strong>Produto:</strong> ${linha[2] ?? ""}</p>
            <p><strong>Departamento:</strong> ${linha[3] ?? ""}</p>
            <p><strong>Seção:</strong> ${linha[4] ?? ""}</p>
            <p><strong>Grupo:</strong> ${linha[5] ?? ""}</p>
            <p><strong>Subgrupo:</strong> ${linha[6] ?? ""}</p>
            <p><strong>Categoria:</strong> ${linha[7] ?? ""}</p>
          </div>
        `;
      });

      container.innerHTML = html;
      status.textContent =
        `${dados.length} produto(s) encontrado(s). Clique em um cartão para preparar o relatório.`;
    }

    // ========== ENVIO DO RELATÓRIO (1ª ETAPA: valida e abre popup) ==========

    function enviarRelatorio(idx) {
      const status = document.getElementById("status");

      if (!ultimosResultados || !ultimosResultados[idx]) {
        status.textContent =
          "Não foi possível identificar o produto selecionado.";
        return;
      }

      const linhaProduto = ultimosResultados[idx];
      const obs = document.getElementById("observacao").value.trim();
      const qtd = document.getElementById("quantidade").value.trim();
      const valor = document.getElementById("valorUnitario").value.trim();
      const doc = document.getElementById("numeroDocumento").value.trim();

      if (!obs) {
        status.textContent =
          "Preencha o relatório/observação antes de enviar.";
        return;
      }

      if (!qtd) {
        status.textContent =
          "Preencha a quantidade antes de enviar.";
        return;
      }

      if (!valor) {
        status.textContent =
          "Preencha o valor unitário antes de enviar.";
        return;
      }

      if (!doc) {
        status.textContent =
          "Preencha o Nº de Documento antes de enviar.";
        return;
      }

      if (!lojaLogada || !usuarioLogado) {
        status.textContent =
          "Sessão inválida. Faça login novamente.";
        return;
      }

      if (navigator.vibrate) {
        navigator.vibrate(60);
      }
      playBeep();

      envioPendente = {
        linhaProduto,
        observacao: obs,
        quantidade: qtd,
        valorUnitario: valor,
        numeroDocumento: doc
      };

      document.getElementById("confirmOverlay").style.display = "flex";
    }

    // ========== ENVIO DO RELATÓRIO (2ª ETAPA: confirmação) ==========

    function confirmarEnvio(confirmado) {
      const overlay = document.getElementById("confirmOverlay");
      const status = document.getElementById("status");

      if (!confirmado) {
        overlay.style.display = "none";
        envioPendente = null;
        status.textContent = "Envio cancelado.";
        return;
      }

      if (!envioPendente) {
        overlay.style.display = "none";
        return;
      }

      const {
        linhaProduto,
        observacao,
        quantidade,
        valorUnitario,
        numeroDocumento
      } = envioPendente;

      envioPendente = null;
      overlay.style.display = "none";

      // Por enquanto, apenas SIMULA o envio.
      // Próximo passo será criar a rota /api/relatorio para gravar na aba RELATORIO.
      console.log("Simulação de envio:", {
        produto: linhaProduto,
        observacao,
        quantidade,
        valorUnitario,
        numeroDocumento,
        loja: lojaLogada,
        usuario: usuarioLogado
      });

      status.textContent =
        "Simulação: relatório seria enviado para a planilha (API de gravação ainda não implementada).";

      // Limpa campos (exceto nº documento, se quiser manter)
      document.getElementById("observacao").value = "";
      document.getElementById("quantidade").value = "";
      document.getElementById("valorUnitario").value = "";
      // Nº documento mantido
    }

    // ========== CÂMERA (mantida igual, futura leitura de código de barras) ==========

    let streamAtual = null;
    let lendo = false;

    function abrirCamera() {
      const area  = document.getElementById("cameraArea");
      const msg   = document.getElementById("msgCamera");
      const video = document.getElementById("video");

      area.style.display = "block";
      msg.textContent = "Abrindo câmera...";

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        msg.textContent =
          "Este dispositivo ou navegador não permite acesso à câmera neste contexto.";
        return;
      }

      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: "environment" } })
        .then(stream => {
          streamAtual = stream;
          video.srcObject = stream;
          video.play();
          msg.textContent = "Aponte para o código de barras...";
          iniciarLeitura(video, msg);
        })
        .catch(err => {
          msg.textContent = "Erro ao acessar câmera: " + err.message;
        });
    }

    async function iniciarLeitura(video, msg) {
      if (!("BarcodeDetector" in window)) {
        msg.textContent =
          "Leitura automática não suportada neste navegador. Digite o código manualmente.";
        return;
      }

      const detector = new BarcodeDetector({
        formats: ["ean_13", "ean_8", "code_128"]
      });

      const canvas = document.createElement("canvas");
      const ctx    = canvas.getContext("2d");

      lendo = true;

      async function scan() {
        if (!lendo) return;

        if (video.readyState === video.HAVE_ENOUGH_DATA) {
          canvas.width  = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          try {
            const codes = await detector.detect(canvas);

            if (codes.length > 0) {
              const code = codes[0].rawValue;

              playBeep();
              msg.textContent = "Detectado: " + code;

              document.getElementById("campoBusca").value = code;

              fecharCamera();
              buscar();
              return;
            }
          } catch(e){}
        }

        requestAnimationFrame(scan);
      }

      scan();
    }

    function fecharCamera() {
      lendo = false;

      if (streamAtual) {
        streamAtual.getTracks().forEach(t => t.stop());
      }

      const video = document.getElementById("video");
      if (video) {
        video.srcObject = null;
      }
      const area = document.getElementById("cameraArea");
      if (area) {
        area.style.display = "none";
      }
    }
  </script>
</body>
</html>
